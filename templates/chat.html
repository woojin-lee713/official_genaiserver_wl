{% extends 'layout.html' %} {% block body %}
<div class="container-fluid p-0 m-0">
    <div class="row m-0" style="height: calc(100vh - 56px); overflow: hidden">
        <!-- Sidebar -->
        <div class="col-md-2 d-flex align-items-stretch p-0 m-0">
            <div
                class="list-group sidebar d-flex flex-column justify-content-start w-100"
                style="height: 100%; border-radius: 0"
            >
                {% for chat in chats %}
                <a
                    href="{{ url_for('open_chat', chat_id=chat.chat_id) }}"
                    class="list-group-item list-group-item-action sidebar-item"
                >
                    {{ chat.title }}
                </a>
                {% endfor %}
            </div>
        </div>
        <!-- Chat Interface Placeholder -->
        <div
            class="col-md-10 d-flex flex-column justify-content-center align-items-center p-0 m-0"
            style="
                height: 100%;
                background: linear-gradient(
                    135deg,
                    #1e3c72,
                    #2a5298,
                    #72a0c1,
                    #a6dcef
                );
                background-size: 400% 400%;
                animation: gradient 15s ease infinite;
                border-radius: 0;
            "
        >
            <div
                class="d-flex flex-column justify-content-center align-items-center"
                style="flex-grow: 1"
            >
                <a
                    href="{% if chats %}{{ url_for('open_chat', chat_id=chats[0].chat_id) }}{% else %}#{% endif %}"
                >
                    <img
                        src="https://i.ibb.co/bFyrMHf/416bc6e8-929e-46fe-84a5-4d2a881081c5-removebg-preview-removebg-preview.png"
                        alt="Chat Icon"
                        border="0"
                        class="img-fluid responsive-img"
                    />
                </a>
                <div
                    id="assist-text"
                    class="mt-3 text-white"
                    style="font-size: 1.5rem"
                ></div>
            </div>
            <div
                class="d-flex flex-column align-items-center w-100"
                style="padding: 20px"
            >
                {% if not chats %}
                <p class="text-white mb-2">
                    No chats available. Create a new chat to get started.
                </p>
                {% endif %}
                <button
                    class="btn btn-md btn-gradient mt-2 responsive-btn"
                    onclick="promptNewChat()"
                >
                    Create New Chat
                </button>
            </div>
        </div>
    </div>
</div>

<!-- New Chat Modal -->
<div
    class="modal fade"
    id="newChatModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="newChatModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newChatModalLabel">
                    Create New Chat
                </h5>
                <button
                    type="button"
                    class="close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                >
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="newChatForm">
                    <div class="form-group">
                        <label for="chatTitle">Chat Title</label>
                        <input
                            type="text"
                            class="form-control"
                            id="chatTitle"
                            name="chatTitle"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="modelSelect">Model</label>
                        <select
                            class="form-control"
                            id="modelSelect"
                            name="modelSelect"
                        >
                            {% for model in models %}
                            <option value="{{ model['modelid'] }}">
                                {{ model['modelname'] }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
                <button
                    type="button"
                    class="btn btn-primary"
                    onclick="createNewChat()"
                >
                    Create Chat
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("a").forEach(function (anchor) {
            anchor.addEventListener("click", function (event) {
                event.preventDefault();
                let linkLocation = this.href;
                document.body.classList.add("fade-out");
                setTimeout(function () {
                    window.location = linkLocation;
                }, 500);
            });
        });

        const texts = [
            "How may I assist you today?",
            "¿Cómo puedo ayudarte hoy?",
            "Comment puis-je vous aider aujourd'hui?",
            "Wie kann ich Ihnen heute behilflich sein?",
            "今日はどのようにお手伝いできますか？",
            "오늘 어떻게 도와드릴까요?",
            "Как я могу помочь вам сегодня?",
            "今天我能为您做些什么？",
            "Come posso aiutarti oggi?",
            "Hoe kan ik u vandaag helpen?",
            "Hvordan kan jeg hjælpe dig i dag?",
            "Hvordan kan jeg hjelpe deg i dag?",
            "Hur kan jag hjälpa dig idag?",
            "Miten voin auttaa tänään?",
            "Jak mogę ci dziś pomóc?",
            "Cum te pot ajuta astăzi?",
            "Wie kan ik u vandaag helpen?",
            "Ako vám môžem dnes pomôcť?",
            "Hogyan segíthetek ma?",
            "Ako vám dnes môžem pomôcť?",
            "Πώς μπορώ να σας βοηθήσω σήμερα;",
            "Hvordan kan jeg assistere deg i dag?",
            "Como posso ajudar você hoje?",
            "Kako vam danas mogu pomoći?",
            "Kako vam mogu danas pomoći?",
            "Kā es varu jums palīdzēt šodien?",
            "Wie kann ich dir heute helfen?",
            "Hvordan kan jeg støtte dig i dag?",
            "Hvernig get ég aðstoðað þig í dag?",
            "Kā varu palīdzēt šodien?",
            "Kaip galiu padėti šiandien?",
            "Wie kann ich Ihnen heute weiterhelfen?",
            "Miten voin olla avuksi tänään?",
        ];
        let index = 0;
        const assistTextElement = document.getElementById("assist-text");

        function changeText() {
            assistTextElement.classList.remove("fade-in");
            assistTextElement.classList.add("fade-out");
            setTimeout(() => {
                assistTextElement.textContent = texts[index];
                assistTextElement.classList.remove("fade-out");
                assistTextElement.classList.add("fade-in");
                index = (index + 1) % texts.length;
            }, 500);
        }

        setInterval(changeText, 3000);
        changeText();
    });

    function promptNewChat() {
        const modal = new bootstrap.Modal(
            document.getElementById("newChatModal"),
        );
        modal.show();
    }

    async function createNewChat() {
        const title = document.getElementById("chatTitle").value;
        const model_id = document.getElementById("modelSelect").value;

        const response = await fetch("/create_chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                title: title,
                model_id: model_id,
            }),
        });

        if (response.ok) {
            location.reload();
        }
    }
</script>

<style>
    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
        }
        to {
            opacity: 0;
        }
    }

    .fade-in {
        animation: fadeIn 0.5s;
    }

    .fade-out {
        animation: fadeOut 0.5s;
    }

    body {
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
    }
    body.fade-out {
        opacity: 0;
    }

    .sidebar {
        background-color: #c8d6e5;
        height: 100%;
        flex-grow: 1;
    }
    .sidebar-item {
        background-color: #1e3c72;
        color: white;
        margin-bottom: 10px;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        transition:
            background-color 0.3s,
            color 0.3s;
    }
    .sidebar-item:hover {
        background-color: #dce8f6;
        color: black;
    }

    .btn-gradient {
        background: linear-gradient(135deg, #6e8efb, #a777e3);
        color: white;
        border: none;
        border-radius: 25px;
        padding: 10px 20px;
        font-size: 16px;
        transition:
            background 0.3s,
            transform 0.3s;
    }
    .btn-gradient:hover {
        background: linear-gradient(135deg, #5a77d1, #8655c5);
        transform: translateY(-2px);
    }

    .responsive-img {
        max-width: 175px;
        width: 100%;
        height: auto;
    }
    .responsive-btn {
        padding: 8px 16px;
        font-size: 14px;
    }

    @media (max-width: 768px) {
        .list-group-item {
            font-size: 0.9rem;
        }
        .responsive-img {
            max-width: 120px;
        }
        .responsive-btn {
            padding: 6px 12px;
            font-size: 12px;
        }
        .sidebar {
            max-width: 150px;
        }
    }
</style>
{% endblock %}
